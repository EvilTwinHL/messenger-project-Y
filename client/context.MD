# üóÇ MESSENGER Y ‚Äî PROJECT CONTEXT v2.6.8
> –í—Å—Ç–∞–≤–ª—è–π —Ü–µ–π —Ñ–∞–π–ª –ø–µ—Ä—à–∏–º –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è–º —É –Ω–æ–≤–æ–º—É —á–∞—Ç—ñ.
> –ü—ñ—Å–ª—è —Ü—å–æ–≥–æ –¥–æ–¥–∞–≤–∞–π –¢–Ü–õ–¨–ö–ò —Ç–æ–π —Ñ–∞–π–ª, –∑ —è–∫–∏–º –∑–∞—Ä–∞–∑ –ø—Ä–∞—Ü—é—î—à.

---

## üì¶ –°–¢–ï–ö

| –®–∞—Ä | –¢–µ—Ö–Ω–æ–ª–æ–≥—ñ—è |
|-----|-----------|
| –ö–ª—ñ—î–Ω—Ç | Flutter 3.x (Android, iOS, Windows) |
| –°–µ—Ä–≤–µ—Ä | Node.js 20 + Express 5 + Socket.IO 4.8 (—Ö–æ—Å—Ç–∏–Ω–≥: Render) |
| –ë–î | Firebase Firestore |
| –°—Ö–æ–≤–∏—â–µ | Firebase Storage |
| Push | FCM multicast (—Ñ—ñ–ª—å—Ç—Ä –ø–æ —É—á–∞—Å–Ω–∏–∫–∞—Ö ‚úÖ) |
| Auth | –ù—ñ–∫–Ω–µ–π–º + –ø–∞—Ä–æ–ª—å + JWT ‚úÖ (–§–∞–∑–∞ 1 –≤–∏–∫–æ–Ω–∞–Ω–∞) |
| OTA | Shorebird Code Push |
| Real-time | Socket.IO rooms + Firestore StreamBuilder |
| Config | flutter_dotenv (.env —Ñ–∞–π–ª) |

---

## üóÇ –°–¢–†–£–ö–¢–£–†–ê –§–ê–ô–õ–Ü–í (–∞–∫—Ç—É–∞–ª—å–Ω–∞ v2.6.8)

```
client/
‚îú‚îÄ‚îÄ .env                           # SERVER_URL=https://pproject-y.onrender.com
‚îú‚îÄ‚îÄ pubspec.yaml
‚îî‚îÄ‚îÄ lib/
    ‚îú‚îÄ‚îÄ config/
    ‚îÇ   ‚îî‚îÄ‚îÄ app_config.dart        # AppConfig.serverUrl + AppConfig.firebaseAvailable
    ‚îú‚îÄ‚îÄ services/
    ‚îÇ   ‚îú‚îÄ‚îÄ socket_service.dart    # SocketService singleton
    ‚îÇ   ‚îî‚îÄ‚îÄ auth_service.dart      # login, logout, getToken, saveUser, getSavedDisplayName
    ‚îú‚îÄ‚îÄ utils/
    ‚îÇ   ‚îî‚îÄ‚îÄ date_utils.dart        # ChatDateUtils
    ‚îú‚îÄ‚îÄ widgets/
    ‚îÇ   ‚îú‚îÄ‚îÄ message_bubble.dart    # status: "sent"|"delivered"|"read" + Signal-style —ñ–∫–æ–Ω–∫–∏
    ‚îÇ   ‚îú‚îÄ‚îÄ swipe_to_reply.dart
    ‚îÇ   ‚îú‚îÄ‚îÄ typing_indicator.dart
    ‚îÇ   ‚îú‚îÄ‚îÄ date_separator.dart
    ‚îÇ   ‚îú‚îÄ‚îÄ reply_preview.dart
    ‚îÇ   ‚îî‚îÄ‚îÄ reaction_widgets.dart
    ‚îú‚îÄ‚îÄ main.dart                  # ChatScreen + _messageStatuses cache
    ‚îú‚îÄ‚îÄ home_screen.dart           # HomeScreen + AccountTab (Telegram-style) + _OvalNavBar
    ‚îú‚îÄ‚îÄ login_screen.dart          # LoginScreen (TabBar: –£–≤—ñ–π—Ç–∏ / –ó–∞—Ä–µ—î—Å—Ç—Ä—É–≤–∞—Ç–∏—Å—å)
    ‚îú‚îÄ‚îÄ search_screen.dart
    ‚îú‚îÄ‚îÄ settings_screen.dart       # –ë–ï–ó —Å–µ–∫—Ü—ñ—ó –ø—Ä–æ—Ñ—ñ–ª—é (–ø–µ—Ä–µ–Ω–µ—Å–µ–Ω–æ –≤ AccountTab)
    ‚îú‚îÄ‚îÄ signal_context_menu.dart
    ‚îú‚îÄ‚îÄ audio_player_widget.dart
    ‚îú‚îÄ‚îÄ voice_recorder.dart
    ‚îî‚îÄ‚îÄ theme.dart

server/
‚îî‚îÄ‚îÄ index.js                      # Express + Socket.IO + Firebase Admin (v2.6.8)
```

---

## ‚öôÔ∏è –í–ê–ñ–õ–ò–í–Ü –ö–û–ù–°–¢–ê–ù–¢–ò –¢–ê –ü–†–ê–í–ò–õ–ê

```dart
// auth_service.dart ‚Äî –û–ù–û–í–õ–ï–ù–û (v2.6.0)
// AuthService.login(username, password, displayName?)  ‚Üí Map —Ç–æ–∫–µ–Ω–∏ + —é–∑–µ—Ä
// AuthService.saveUser(username, displayName, avatarUrl?) ‚Üí –∑–±–µ—Ä—ñ–≥–∞—î –ª–æ–∫–∞–ª—å–Ω–æ
// AuthService.getSavedDisplayName() ‚Üí String?
// AuthService.getSavedUsername()    ‚Üí String?
// AuthService.getSavedAvatarUrl()   ‚Üí String?
// AuthService.getToken()            ‚Üí String?
// AuthService.logout()              ‚Üí –æ—á–∏—â–∞—î –≤—Å—ñ –∑–±–µ—Ä–µ–∂–µ–Ω—ñ –¥–∞–Ω—ñ

// home_screen.dart ‚Äî AccountTab (v2.6.0)
// –ê–∫–∞—É–Ω—Ç-—Ç–∞–± Telegram-—Å—Ç–∏–ª—å:
//   - –ê–≤–∞—Ç–∞—Ä –∑ camera badge (—Ä–µ–¥–∞–≥—É–≤–∞–Ω–Ω—è)
//   - DisplayName + @username + –æ–Ω–ª–∞–π–Ω-—Å—Ç–∞—Ç—É—Å (–∫–ª—ñ–∫–∞–±–µ–ª—å–Ω–∏–π)
//   - 3 –∫–Ω–æ–ø–∫–∏: –§–æ—Ç–æ / –†–µ–¥–∞–≥—É–≤–∞—Ç–∏ / –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è
//   - –Ü–Ω—Ñ–æ-–∫–∞—Ä—Ç–∫–∞: phone, @username (copy), birthday + visibility
//   - –ö–Ω–æ–ø–∫–∞ –í–∏–π—Ç–∏
//   - –í—Å—ñ –∑–º—ñ–Ω–∏ ‚Üí _pushProfileToServer() ‚Üí POST /update_profile

// login_screen.dart ‚Äî Split (v2.6.0)
// TabBar –∑ –¥–≤–æ–º–∞ –≤–∫–ª–∞–¥–∫–∞–º–∏:
//   "–£–≤—ñ–π—Ç–∏" ‚Üí username + password
//   "–ó–∞—Ä–µ—î—Å—Ç—Ä—É–≤–∞—Ç–∏—Å—å" ‚Üí username + displayName (optional) + password + confirm
// –ü—Ä–∏ –∑–∞–ø—É—Å–∫—É: —è–∫—â–æ —î –∑–±–µ—Ä–µ–∂–µ–Ω–∏–π phone ‚Üí GET /accounts_by_phone
//   ‚Üí suggestedAccounts ‚Üí _AccountPickerSheet (bottomSheet)

// message_bubble.dart ‚Äî –°—Ç–∞—Ç—É—Å–∏ (v2.6.3)
// status: String? ("sent" | "delivered" | "read") ‚Äî –∑–∞–º—ñ–Ω—é—î isRead: bool
// _StatusIcon ‚Üí _SignalStatus ‚Üí _StatusPainter (CustomPainter):
//   sent      = 1 –∫—Ä—É–∂–æ–∫, —Å—ñ—Ä–∏–π –∫–æ–Ω—Ç—É—Ä + —Å–∏–Ω—è –∑–∞–ª–∏–≤–∫–∞ (#2B5CE6) + —Å—ñ—Ä–∞ –≥–∞–ª–æ—á–∫–∞
//   delivered = 2 –∫—Ä—É–∂–∫–∏, —Å—ñ—Ä–∏–π –∫–æ–Ω—Ç—É—Ä + —Å–∏–Ω—è –∑–∞–ª–∏–≤–∫–∞ + —Å—ñ—Ä—ñ –≥–∞–ª–æ—á–∫–∏ (–æ–±–∏–¥–≤–∞)
//   read      = 2 –∫—Ä—É–∂–∫–∏, —Å–∏–Ω—ñ–π –∫–æ–Ω—Ç—É—Ä (#2B5CE6) + —Å—ñ—Ä–∞ –∑–∞–ª–∏–≤–∫–∞ + —Å–∏–Ω—ñ –≥–∞–ª–æ—á–∫–∏

// main.dart ‚Äî _messageStatuses (v2.6.5)
// Map<String, String> _messageStatuses ‚Äî –ª–æ–∫–∞–ª—å–Ω–∏–π –∫–µ—à —Å—Ç–∞—Ç—É—Å—ñ–≤
// –û–Ω–æ–≤–ª—é—î—Ç—å—Å—è —á–µ—Ä–µ–∑ socket 'message_status_update' –¥–ª—è –û–ë–û–• —Ä–µ–∂–∏–º—ñ–≤
// –ü–µ—Ä–µ–∫—Ä–∏–≤–∞—î —Å—Ç–∞—Ç—É—Å –∑ Firestore/localMessages –¥–ª—è –º–∏—Ç—Ç—î–≤–æ–≥–æ –≤—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è
// –ó–∞–ø–æ–≤–Ω—é—î—Ç—å—Å—è –ø—Ä–∏ load_history —ñ receive_message
// mark_read –µ–º—ñ—Ç—É—î—Ç—å—Å—è –ø—Ä–∏ onConnect –Ü –ø—Ä–∏ receive_message –≤—ñ–¥ —ñ–Ω—à–æ–≥–æ
```

```javascript
// server/index.js v2.6.8 ‚Äî –Ω–æ–≤—ñ –µ–Ω–¥–ø–æ—ñ–Ω—Ç–∏ —Ç–∞ Socket –ø–æ–¥—ñ—ó

// POST /update_profile (verifyJWT) ‚Äî –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –ø—Ä–æ—Ñ—ñ–ª—é
// –ü–æ–ª—è: displayName, avatarUrl, phone, birthday, birthdayVisible, onlineVisible

// GET /accounts_by_phone?phone=... (–±–µ–∑ auth) ‚Äî –∞–∫–∞—É–Ω—Ç–∏ –ø–æ —Ç–µ–ª–µ—Ñ–æ–Ω—É
// –ü–æ–≤–µ—Ä—Ç–∞—î –¥–æ 5 –∞–∫–∞—É–Ω—Ç—ñ–≤: { username, displayName, avatarUrl }

// Socket: send_message ‚Üí status: 'sent' ‚Üí –º–∏—Ç—Ç—î–≤–∞ –ø–µ—Ä–µ–≤—ñ—Ä–∫–∞ delivered
//   –ü–µ—Ä–µ–≤—ñ—Ä—è—î –≤—Å—ñ io.sockets.sockets (–Ω–µ —Ç—ñ–ª—å–∫–∏ –∫—ñ–º–Ω–∞—Ç—É!)
//   –Ø–∫—â–æ –æ—Ç—Ä–∏–º—É–≤–∞—á –æ–Ω–ª–∞–π–Ω (–±—É–¥—å-—è–∫–∏–π —Å–æ–∫–µ—Ç) ‚Üí –æ–¥—Ä–∞–∑—É delivered

// Socket: join_chat ‚Üí batch update sent‚Üídelivered –¥–ª—è —á—É–∂–∏—Ö –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å
//   –û–¥–∏–Ω–æ—á–Ω—ñ –∑–∞–ø–∏—Ç–∏ (–Ω–µ compound) ‚Üí —Ñ—ñ–ª—å—Ç—Ä –≤ JS

// Socket: mark_read ‚Üí batch update sent|delivered‚Üíread –¥–ª—è —á—É–∂–∏—Ö –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å
//   –î–≤–∞ –æ–∫—Ä–µ–º–∏—Ö –∑–∞–ø–∏—Ç–∏ (sent —ñ delivered) ‚Üí —Ñ—ñ–ª—å—Ç—Ä –≤ JS ‚Üí emit message_status_update

// Socket emit: 'message_status_update' ‚Üí { messageId, status }
```

---

## üîê –ê–í–¢–û–†–ò–ó–ê–¶–Ü–Ø (–§–∞–∑–∞ 1 ‚Äî –≤–∏–∫–æ–Ω–∞–Ω–æ)

```
POST /auth  { username, password, displayName?, avatarUrl? }
  ‚Üí { status: "created"|"found", token, refreshToken, user }

POST /refresh  { refreshToken }
  ‚Üí { token }

JWT: access token ‚Äî 7 –¥–Ω—ñ–≤, refresh token ‚Äî 30 –¥–Ω—ñ–≤
bcrypt rounds: 12

–ó–∞—Ö–∏—â–µ–Ω—ñ –µ–Ω–¥–ø–æ—ñ–Ω—Ç–∏ (verifyJWT):
  POST /upload, POST /upload-audio
  GET  /search_users
  POST /get_or_create_dm, GET /get_user_chats
  POST /update_profile ‚úÖ NEW v2.6.0
```

---

## üé® –î–ò–ó–ê–ô–ù-–°–ò–°–¢–ï–ú–ê (theme.dart)

```dart
SignalColors.primary        // #2B5CE6
SignalColors.appBackground  // #111113
SignalColors.surface        // #1A1B1D
SignalColors.elevated       // #252528
SignalColors.outgoing       // #2B5CE6
SignalColors.incoming       // #2C2C2E
SignalColors.textPrimary    // #FFFFFF
SignalColors.textSecondary  // #8E8E9A
SignalColors.danger         // —á–µ—Ä–≤–æ–Ω–∏–π
SignalColors.online         // –∑–µ–ª–µ–Ω–∏–π

AppSizes.navBarHeight       // 72
AppSizes.bubbleRadius       // 18
AppSizes.avatarRadiusMedium // 27
```

---

## üî• FIRESTORE –°–¢–†–£–ö–¢–£–†–ê

```
users/{username}
  username, displayName ‚úÖ NEW v2.6.0
  avatarUrl, passwordHash, createdAt
  phone, birthday, birthdayVisible, onlineVisible ‚úÖ NEW v2.6.0
  [–ü–õ–ê–ù –§2] online, lastSeen

chats/{chatId}
  type: "dm"
  participants: [username1, username2]
  participantNames: { username1: displayName1 } ‚úÖ NEW v2.6.0
  lastMessage: { text, sender, timestamp, read }

chats/{chatId}/messages/{messageId}
  text, sender, senderAvatar, type
  timestamp, read, edited, editedAt
  status: "sent"|"delivered"|"read" ‚úÖ NEW v2.6.3
  replyTo: { id, text, sender }
  reactions: { "‚ù§Ô∏è": ["user1"] }
  audioUrl, audioDuration, imageUrl

fcm_tokens/{token}
  username, updatedAt
```

---

## üîå SOCKET.IO ‚Äî –ü–æ–¥—ñ—ó

### –ö–ª—ñ—î–Ω—Ç ‚Üí –°–µ—Ä–≤–µ—Ä
| –ü–æ–¥—ñ—è | –î–∞–Ω—ñ |
|-------|------|
| `join_chat` | chatId ‚Üí auto delivered update |
| `send_message` | { chatId, text, type, ... } |
| `mark_read` | { chatId, readerUsername } |
| `delete_message` | { messageId, chatId } |
| `edit_message` | { messageId, newText, chatId } |
| `add_reaction` | { messageId, emoji, chatId } |
| `typing` | { chatId } |
| `register_token` | { token } |
| `request_history` | chatId |

### –°–µ—Ä–≤–µ—Ä ‚Üí –ö–ª—ñ—î–Ω—Ç
| –ü–æ–¥—ñ—è | –î–∞–Ω—ñ |
|-------|------|
| `receive_message` | messageData (–∑ status: 'sent') |
| `message_status_update` | { messageId, status } ‚úÖ NEW |
| `load_history` | message[] |
| `message_deleted` | messageId |
| `message_edited` | { messageId, newText } |
| `reaction_updated` | { messageId, reactions } |
| `display_typing` | { username, chatId } |

---

## üåê REST API

| –ú–µ—Ç–æ–¥ | –ï–Ω–¥–ø–æ—ñ–Ω—Ç | Auth | –û–ø–∏—Å |
|-------|----------|------|------|
| POST | `/auth` | ‚ùå | { username, password, displayName? } ‚Üí { token, refreshToken, user } |
| POST | `/refresh` | ‚ùå | { refreshToken } ‚Üí { token } |
| POST | `/upload` | ‚úÖ | —Ñ–æ—Ç–æ ‚Üí { url } |
| POST | `/upload-audio` | ‚úÖ | –∞—É–¥—ñ–æ ‚Üí { url } |
| GET | `/search_users?q=&myUsername=` | ‚úÖ | –ø–æ—à—É–∫ |
| POST | `/get_or_create_dm` | ‚úÖ | ‚Üí chat |
| GET | `/get_user_chats?username=` | ‚úÖ | —Å–ø–∏—Å–æ–∫ —á–∞—Ç—ñ–≤ (Windows) |
| POST | `/update_profile` | ‚úÖ | displayName, phone, birthday... ‚úÖ NEW |
| GET | `/accounts_by_phone?phone=` | ‚ùå | –∞–∫–∞—É–Ω—Ç–∏ –ø–æ —Ç–µ–ª–µ—Ñ–æ–Ω—É ‚úÖ NEW |
| GET | `/ping` | ‚ùå | health check |

---

## ‚úÖ –©–û –†–ï–ê–õ–Ü–ó–û–í–ê–ù–û (v2.6.8)

- [x] –ü—Ä–∏–≤–∞—Ç–Ω—ñ —á–∞—Ç–∏ (DM) ‚Äî Firestore + Socket.IO
- [x] **displayName vs username** ‚Äî displayName (–±—É–¥—å-—è–∫–∞ –º–æ–≤–∞), username (Latin, immutable) ‚úÖ NEW
- [x] –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü—ñ—è ‚Äî username + password (bcrypt) + JWT
- [x] **Login/Register —Ä–æ–∑–¥—ñ–ª–µ–Ω–æ** ‚Äî TabBar –∑ –¥–≤–æ–º–∞ –≤–∫–ª–∞–¥–∫–∞–º–∏ ‚úÖ NEW
- [x] **AccountTab (Telegram-style)** ‚Äî –∞–≤–∞—Ç–∞—Ä, —Å—Ç–∞—Ç—É—Å, phone, birthday, edit ‚úÖ NEW
- [x] **–ê–∫–∞—É–Ω—Ç–∏ –ø–æ —Ç–µ–ª–µ—Ñ–æ–Ω—É** ‚Äî suggestedAccounts –ø—Ä–∏ –∑–∞–ø—É—Å–∫—É ‚úÖ NEW
- [x] **POST /update_profile** ‚Äî phone, birthday, onlineVisible, displayName ‚úÖ NEW
- [x] **–°—Ç–∞—Ç—É—Å–∏ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å** ‚úì/‚úì‚úì/‚úì‚úì—Å–∏–Ω—ñ–π ‚Äî sent/delivered/read ‚úÖ NEW
- [x] **Signal-style —ñ–∫–æ–Ω–∫–∏ —Å—Ç–∞—Ç—É—Å—ñ–≤** ‚Äî CustomPainter –∑ –∫—Ä—É–∂–µ—á–∫–∞–º–∏ —ñ –≥–∞–ª–æ—á–∫–∞–º–∏ ‚úÖ NEW
- [x] **Real-time —Å—Ç–∞—Ç—É—Å–∏** ‚Äî _messageStatuses cache + mark_read on receive ‚úÖ NEW
- [x] Rate limiting + Helmet + Morgan + Joi –≤–∞–ª—ñ–¥–∞—Ü—ñ—è
- [x] Socket.IO auth middleware (JWT)
- [x] –ù–∞–¥—Å–∏–ª–∞–Ω–Ω—è —Ñ–æ—Ç–æ (Firebase Storage)
- [x] –ì–æ–ª–æ—Å–æ–≤—ñ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è + Waveform –ø–ª–µ—î—Ä
- [x] –†–µ–∞–∫—Ü—ñ—ó –Ω–∞ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è
- [x] Reply + swipe-to-reply
- [x] –†–µ–¥–∞–≥—É–≤–∞–Ω–Ω—è —Ç–∞ –≤–∏–¥–∞–ª–µ–Ω–Ω—è –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å
- [x] Signal Dark UI (SignalColors + AppSizes)
- [x] –ü–ª–∞–≤–∞—é—á–∞ –æ–≤–∞–ª—å–Ω–∞ –Ω–∞–≤—ñ–≥–∞—Ü—ñ—è
- [x] FCM Push (—Ç—ñ–ª—å–∫–∏ —É—á–∞—Å–Ω–∏–∫–∞–º)
- [x] Windows –ø—ñ–¥—Ç—Ä–∏–º–∫–∞ (HTTP fallback)
- [x] Shorebird OTA
- [x] Typing indicator
- [x] –†–æ–∑–¥—ñ–ª—é–≤–∞—á—ñ –¥–∞—Ç + Scroll Date Overlay
- [x] –ö–æ–Ω—Ç–µ–∫—Å—Ç–Ω–µ –º–µ–Ω—é Signal-—Å—Ç–∏–ª—å
- [x] –ü–æ—à—É–∫ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤

---

## üêõ –í–Ü–î–û–ú–Ü –ü–†–û–ë–õ–ï–ú–ò / –ù–ê–°–¢–£–ü–ù–Ü –ö–†–û–ö–ò

- [ ] –û–Ω–ª–∞–π–Ω-—Å—Ç–∞—Ç—É—Å —É AppBar —á–∞—Ç—É ("–æ–Ω–ª–∞–π–Ω" / "–±—É–≤ –æ HH:MM") ‚Äî **–∑–∞—Ä–∞–∑ —Ö–∞—Ä–¥–∫–æ–¥**
- [ ] –ü–∞–≥—ñ–Ω–∞—Ü—ñ—è –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å ‚Äî —Ç—ñ–ª—å–∫–∏ –æ—Å—Ç–∞–Ω–Ω—ñ 50
- [ ] –ì—Ä—É–ø–æ–≤—ñ —á–∞—Ç–∏
- [ ] –®–∞—Ä—ñ–Ω–≥ —Ñ–∞–π–ª—ñ–≤ (PDF, DOCX, ZIP)
- [ ] WebRTC –¥–∑–≤—ñ–Ω–∫–∏

---

## ‚ö†Ô∏è –í–ê–ñ–õ–ò–í–Ü –ù–Æ–ê–ù–°–ò

```
1. DateUtils ‚Üí ChatDateUtils (–∫–æ–Ω—Ñ–ª—ñ–∫—Ç –∑ Flutter material.dart)
   import 'utils/date_utils.dart';

2. SettingsScreen ‚Äî –ù–ï –¥–æ–¥–∞–≤–∞—Ç–∏ leading: IconButton —É AppBar
   (–≤—ñ–¥–∫—Ä–∏–≤–∞—î—Ç—å—Å—è —è–∫ –≤–∫–ª–∞–¥–∫–∞ IndexedStack)

3. SocketService.init() ‚Äî –û–ë–û–í'–Ø–ó–ö–û–í–û –ø–µ—Ä–µ–¥–∞–≤–∞—Ç–∏ token:
   final token = await AuthService.getToken();
   _socketSvc.init(token: token ?? '');

4. HTTP –∑–∞–ø–∏—Ç–∏ –¥–æ –∑–∞—Ö–∏—â–µ–Ω–∏—Ö –µ–Ω–¥–ø–æ—ñ–Ω—Ç—ñ–≤:
   headers: {'Authorization': 'Bearer ${token ?? ''}'}

5. sender —É Socket –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è—Ö –±–µ—Ä–µ—Ç—å—Å—è –∑ JWT (socket.username)

6. message_bubble.dart ‚Äî –ù–ï –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ isRead: bool (–∑–∞—Å—Ç–∞—Ä—ñ–ª–∏–π)
   –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ status: String? ("sent"|"delivered"|"read")

7. –°—Ç–∞—Ç—É—Å–∏ ‚Äî Firestore compound query –≤–∏–º–∞–≥–∞—î index!
   –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î–º–æ –¥–≤–∞ –æ–∫—Ä–µ–º–∏—Ö –∑–∞–ø–∏—Ç–∏ + —Ñ—ñ–ª—å—Ç—Ä –≤ JS

8. _messageStatuses[msgId] –ú–ê–Ñ –ø—Ä—ñ–æ—Ä–∏—Ç–µ—Ç –Ω–∞–¥ msg['status'] –∑ Firestore
```

---

## üí° –Ø–ö –í–ò–ö–û–†–ò–°–¢–û–í–£–í–ê–¢–ò –¶–ï–ô –§–ê–ô–õ

```
–ù–æ–≤–∏–π —á–∞—Ç ‚Üí –≤—Å—Ç–∞–≤–∏—Ç–∏ CONTEXT.md ‚Üí –¥–æ–¥–∞—Ç–∏ –¢–Ü–õ–¨–ö–ò –ø–æ—Ç—Ä—ñ–±–Ω–∏–π —Ñ–∞–π–ª:

"–ø—Ä–æ—Ñ—ñ–ª—å / –∞–∫–∞—É–Ω—Ç"        ‚Üí home_screen.dart
"–ª–æ–≥—ñ–Ω / —Ä–µ—î—Å—Ç—Ä–∞—Ü—ñ—è"      ‚Üí login_screen.dart
"—Å—Ç–∞—Ç—É—Å–∏ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å"     ‚Üí widgets/message_bubble.dart + main.dart
"–ø—Ä–æ–±–ª–µ–º–∞ —É —á–∞—Ç—ñ"         ‚Üí main.dart
"—Å–µ—Ä–≤–µ—Ä / API"            ‚Üí server/index.js
"–Ω–∞–≤—ñ–≥–∞—Ü—ñ—è / HomeScreen"  ‚Üí home_screen.dart
"–Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è"            ‚Üí settings_screen.dart
"–∞–≤—Ç–æ—Ä–∏–∑–∞—Ü—ñ—è / JWT"       ‚Üí services/auth_service.dart
"–ø–æ—à—É–∫"                   ‚Üí search_screen.dart
"–∫–æ–ª—å–æ—Ä–∏ / —Ç–µ–º–∏"          ‚Üí theme.dart
"–∞—É–¥—ñ–æ –ø–ª–µ—î—Ä"             ‚Üí audio_player_widget.dart
"—Å–æ–∫–µ—Ç"                   ‚Üí services/socket_service.dart
"–¥–∞—Ç–∞/—á–∞—Å"                ‚Üí utils/date_utils.dart
```